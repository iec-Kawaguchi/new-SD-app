<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <title>申込状況サンプル</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="../js/role-visibility.js" defer></script>

    <style>
        /* フォント設定 */
        body {
            font-family: 'Noto Sans JP', sans-serif;
        }
        /* アイコン設定 */
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        .icon-sm { font-size: 1.125rem !important; } /* 18px */
        .icon-md { font-size: 1.25rem !important; }  /* 20px */
        
        /* スクロールバー（iframe内でも綺麗に見せる） */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 20px;
        }
    </style>
</head>
<body class="bg-gray-50 p-6 text-gray-900 antialiased">

    <div class="flex justify-between items-start mb-6">
        <div>
            <h2 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                <span class="material-symbols-outlined text-blue-600 icon-md">insights</span>
                申込状況
            </h2>
            <p class="text-xs text-gray-500 mt-1 ml-7">
                現在の申込・承認ステータスのサマリーとコース別内訳
            </p>
        </div>

         <a id="btn-go-manage"
           href="applications-manage.html"
           class="inline-flex items-center gap-1.5 px-4 py-2 rounded-md border border-blue-200 text-blue-700 bg-blue-50 hover:bg-blue-100 hover:border-blue-300 text-xs font-bold transition-all shadow-sm"
           data-visible-for="iec, customer">
          <span class="material-symbols-outlined icon-sm">assignment_turned_in</span>
          申込承認画面へ
        </a>
    </div>

    <div class="bg-white border border-gray-200 rounded-xl shadow-sm p-4 mb-6">
        <div class="flex flex-wrap items-end gap-4">
            <div class="flex flex-col gap-1.5 flex-1 min-w-[200px]">
                <label for="filter-period" class="text-xs font-bold text-gray-500 uppercase tracking-wide">申込期間</label>
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                        <span class="material-symbols-outlined text-gray-400 icon-sm">event_upcoming</span>
                    </div>
                    <select id="filter-period"
                            class="h-10 block w-full rounded-md border border-gray-300 pl-10 pr-8 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50/50 appearance-none transition-shadow cursor-pointer hover:bg-white">
                        </select>
                    <div class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
                        <span class="material-symbols-outlined text-gray-400 icon-sm">expand_more</span>
                    </div>
                </div>
            </div>

            <div class="flex flex-col gap-1.5 flex-1 min-w-[200px]">
                <label for="filter-opening" class="text-xs font-bold text-gray-500 uppercase tracking-wide">開講日</label>
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                        <span class="material-symbols-outlined text-gray-400 icon-sm">calendar_month</span>
                    </div>
                    <select id="filter-opening"
                            class="h-10 block w-full rounded-md border border-gray-300 pl-10 pr-8 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50/50 appearance-none transition-shadow cursor-pointer hover:bg-white disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed">
                        </select>
                    <div class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
                        <span class="material-symbols-outlined text-gray-400 icon-sm">expand_more</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-3 pt-3 border-t border-gray-100 flex items-center gap-1.5 text-xs text-gray-500">
            <span class="material-symbols-outlined text-base text-blue-500">info</span>
            <span id="filter-label">すべての申込期間・開講日を表示中</span>
        </div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8">
        <div class="relative bg-white border border-gray-200 rounded-xl p-4 shadow-[0_1px_2px_rgba(0,0,0,0.05)] overflow-hidden group hover:border-blue-300 transition-colors">
            <div class="absolute left-0 top-0 bottom-0 w-1 bg-blue-500"></div>
            <div class="flex items-start justify-between pl-2">
                <div>
                    <div class="text-xs font-medium text-gray-500 mb-1">総申込件数</div>
                    <div id="summary-total" class="text-2xl font-bold text-gray-800 tracking-tight">124</div>
                </div>
                <div class="flex p-2 bg-blue-50 rounded-lg text-blue-600">
                    <span class="material-symbols-outlined icon-md">group_add</span>
                </div>
            </div>
        </div>

        <div class="relative bg-white border border-gray-200 rounded-xl p-4 shadow-[0_1px_2px_rgba(0,0,0,0.05)] overflow-hidden group hover:border-emerald-300 transition-colors">
            <div class="absolute left-0 top-0 bottom-0 w-1 bg-emerald-500"></div>
            <div class="flex items-start justify-between pl-2">
                <div>
                    <div class="text-xs font-medium text-gray-500 mb-1">承認済み</div>
                    <div id="summary-approved" class="text-2xl font-bold text-emerald-600 tracking-tight">108</div>
                </div>
                <div class="flex p-2 bg-emerald-50 rounded-lg text-emerald-600">
                    <span class="material-symbols-outlined icon-md">check_circle</span>
                </div>
            </div>
        </div>

        <div class="relative bg-white border border-gray-200 rounded-xl p-4 shadow-[0_1px_2px_rgba(0,0,0,0.05)] overflow-hidden group hover:border-orange-300 transition-colors">
            <div class="absolute left-0 top-0 bottom-0 w-1 bg-orange-400"></div>
            <div class="flex items-start justify-between pl-2">
                <div>
                    <div class="text-xs font-medium text-gray-500 mb-1">未承認</div>
                    <div id="summary-pending" class="text-2xl font-bold text-orange-500 tracking-tight">16</div>
                </div>
                <div class="flex p-2 bg-orange-50 rounded-lg text-orange-500">
                    <span class="material-symbols-outlined icon-md">pending_actions</span>
                </div>
            </div>
        </div>
    </div>

    <div class="space-y-3">
        <h3 class="text-sm font-bold text-gray-700 flex items-center gap-2 px-1">
            <span class="material-symbols-outlined text-gray-400 icon-md">list_alt</span>
            コース別申込状況
        </h3>
        
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            <table class="w-full text-left text-sm">
                <thead class="bg-gray-50/80 border-b border-gray-200 text-xs text-gray-500 uppercase tracking-wider">
                    <tr>
                        <th class="px-5 py-3 font-semibold">コース名</th>
                        <th class="px-5 py-3 font-semibold">団体</th>
                        <th class="px-5 py-3 font-semibold text-right">申込数</th>
                    </tr>
                </thead>
                <tbody id="course-rows" class="divide-y divide-gray-100">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        
        // ====== サンプルデータ定義 ======
        // application-modal.html 側のサンプルに合わせた開講日を定義
        const PERIODS = [
            { id: "all", label: "すべての申込期間" },
            { id: "2026-h1", label: "2026年度上期募集（例：2026/05/01〜05/15）" },
            { id: "2026-h2", label: "2026年度下期募集（例：2026/11/01〜11/15）" }
        ];

        const OPENINGS_BY_PERIOD = {
            "all": [
                { id: "all", label: "すべての開講日" }
            ],
            "2026-h1": [
                { id: "all", label: "すべての開講日" },
                { id: "2026-06-01", label: "2026/06/01 開講" },
                { id: "2026-07-01", label: "2026/07/01 開講" }
            ],
            "2026-h2": [
                { id: "all", label: "すべての開講日" },
                { id: "2026-12-01", label: "2026/12/01 開講" },
                { id: "2026-12-15", label: "2026/12/15 開講" },
                { id: "2027-01-05", label: "2027/01/05 開講" }
            ]
        };

        // 各絞り込み条件ごとのサマリー＆コース一覧
        const STATS = [
            // 全体
            {
                periodId: "all",
                openingId: "all",
                summary: { total: 124, approved: 108, pending: 16 },
                courses: [
                    { name: "基礎から学ぶExcel", group: "団体A", count: 42 },
                    { name: "DX入門",           group: "団体A", count: 33 },
                    { name: "ビジネス文章講座", group: "団体A", count: 20 },
                    { name: "プロジェクト管理", group: "団体A", count: 29 }
                ]
            },
            // 2026年度上期：すべての開講日
            {
                periodId: "2026-h1",
                openingId: "all",
                summary: { total: 76, approved: 65, pending: 11 }, // 40 + 36 のイメージ
                courses: [
                    { name: "基礎から学ぶExcel", group: "団体A", count: 30 },
                    { name: "DX入門",           group: "団体A", count: 26 },
                    { name: "ビジネス文章講座", group: "団体A", count: 20 }
                ]
            },
            // 2026/06/01 開講
            {
                periodId: "2026-h1",
                openingId: "2026-06-01",
                summary: { total: 40, approved: 34, pending: 6 },
                courses: [
                    { name: "基礎から学ぶExcel", group: "団体A", count: 22 },
                    { name: "DX入門",           group: "団体A", count: 18 }
                ]
            },
            // 2026/07/01 開講
            {
                periodId: "2026-h1",
                openingId: "2026-07-01",
                summary: { total: 36, approved: 31, pending: 5 },
                courses: [
                    { name: "ビジネス文章講座", group: "団体A", count: 16 },
                    { name: "プロジェクト管理", group: "団体A", count: 20 }
                ]
            },
            // 2026年度下期：すべての開講日
            {
                periodId: "2026-h2",
                openingId: "all",
                summary: { total: 48, approved: 43, pending: 5 }, // 20+16+12 のイメージ
                courses: [
                    { name: "DX入門",           group: "団体A", count: 7  },
                    { name: "ビジネス文章講座", group: "団体A", count: 24 },
                    { name: "プロジェクト管理", group: "団体A", count: 17 }
                ]
            },
            // 2026/12/01 開講
            {
                periodId: "2026-h2",
                openingId: "2026-12-01",
                summary: { total: 20, approved: 17, pending: 3 },
                courses: [
                    { name: "ビジネス文章講座", group: "団体A", count: 11 },
                    { name: "プロジェクト管理", group: "団体A", count: 9 }
                ]
            },
            // 2026/12/15 開講
            {
                periodId: "2026-h2",
                openingId: "2026-12-15",
                summary: { total: 16, approved: 14, pending: 2 },
                courses: [
                    { name: "DX入門",           group: "団体A", count: 6 },
                    { name: "ビジネス文章講座", group: "団体A", count: 10 }
                ]
            },
            // 2027/01/05 開講
            {
                periodId: "2026-h2",
                openingId: "2027-01-05",
                summary: { total: 12, approved: 12, pending: 0 },
                courses: [
                    { name: "プロジェクト管理", group: "団体A", count: 12 }
                ]
            }
        ];

        // ====== DOM 要素参照 ======
        const periodSelect  = document.getElementById("filter-period");
        const openingSelect = document.getElementById("filter-opening");
        const filterLabel   = document.getElementById("filter-label");

        const summaryTotal    = document.getElementById("summary-total");
        const summaryApproved = document.getElementById("summary-approved");
        const summaryPending  = document.getElementById("summary-pending");
        const courseRowsBody  = document.getElementById("course-rows");

        // ====== 初期化 ======
        function initPeriodOptions() {
            PERIODS.forEach(p => {
                const opt = document.createElement("option");
                opt.value = p.id;
                opt.textContent = p.label;
                periodSelect.appendChild(opt);
            });
            periodSelect.value = "all";
        }

        function initOpeningOptions(periodId) {
            openingSelect.innerHTML = "";
            const list = OPENINGS_BY_PERIOD[periodId] || OPENINGS_BY_PERIOD["all"];
            list.forEach(o => {
                const opt = document.createElement("option");
                opt.value = o.id;
                opt.textContent = o.label;
                openingSelect.appendChild(opt);
            });

            // 「すべての申込期間」の場合は開講日フィルタは全体のみ・半透明
            if (periodId === "all") {
                openingSelect.value = "all";
                openingSelect.disabled = true;
                // スタイルはCSS側で制御(disabled属性)
            } else {
                openingSelect.disabled = false;
            }
        }

        function findStats(periodId, openingId) {
            // まず完全一致を探す
            let found = STATS.find(s => s.periodId === periodId && s.openingId === openingId);
            // なければ period+all を探す
            if (!found) {
                found = STATS.find(s => s.periodId === periodId && s.openingId === "all");
            }
            // それでもなければ全体
            if (!found) {
                found = STATS.find(s => s.periodId === "all" && s.openingId === "all");
            }
            return found;
        }

        function updateLabel(periodId, openingId) {
            const p = PERIODS.find(x => x.id === periodId);
            const openings = OPENINGS_BY_PERIOD[periodId] || OPENINGS_BY_PERIOD["all"];
            const o = openings.find(x => x.id === openingId) || openings[0];

            if (periodId === "all") {
                filterLabel.textContent = "すべての申込期間・開講日を表示中";
            } else if (openingId === "all") {
                filterLabel.textContent = `${p?.label ?? ""}／すべての開講日を表示中`;
            } else {
                filterLabel.textContent = `${p?.label ?? ""}／${o?.label ?? ""} の申込状況を表示中`;
            }
        }

        function render(stats) {
            // サマリー
            summaryTotal.textContent    = stats.summary.total;
            summaryApproved.textContent = stats.summary.approved;
            summaryPending.textContent  = stats.summary.pending;

            // テーブル
            courseRowsBody.innerHTML = "";
            stats.courses.forEach(c => {
                const tr = document.createElement("tr");
                tr.className = "hover:bg-gray-50/70 transition-colors";
                tr.innerHTML = `
                    <td class="px-5 py-3 font-medium text-gray-800">${c.name}</td>
                    <td class="px-5 py-3 text-gray-500">${c.group}</td>
                    <td class="px-5 py-3 font-bold text-right text-blue-600">${c.count}</td>
                `;
                courseRowsBody.appendChild(tr);
            });
        }

        function handleChange() {
            const periodId  = periodSelect.value;
            const openingId = openingSelect.value || "all";
            const stats = findStats(periodId, openingId);
            render(stats);
            updateLabel(periodId, openingId);
        }

        // DOM 読み込み後に初期化
        document.addEventListener("DOMContentLoaded", () => {
            initPeriodOptions();
            initOpeningOptions("all");

            const initialStats = findStats("all", "all");
            render(initialStats);
            updateLabel("all", "all");

            periodSelect.addEventListener("change", () => {
                const periodId = periodSelect.value;
                initOpeningOptions(periodId);
                handleChange();
            });

            openingSelect.addEventListener("change", handleChange);
        });
    </script>

</body>
</html>