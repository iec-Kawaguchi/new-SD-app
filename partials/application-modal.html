<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <title>申込期間登録 - プロフェッショナル版</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto+Sans+JP', sans-serif; }
        .accordion-content { transition: max-height 0.3s ease-out; overflow: hidden; }
        .period-card.active { border-color: #3b82f6; ring: 2px; --tw-ring-color: #3b82f6; }
        .dot-line::before {
            content: '';
            position: absolute;
            left: 27px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-image: linear-gradient(to bottom, #e5e7eb 50%, transparent 50%);
            background-size: 2px 8px;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 antialiased pb-24">
	<header class="sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b border-gray-100 px-6 py-4">
            <div class="flex items-center gap-2 mb-1">
                <span class="material-symbols-outlined text-blue-600">calendar_add_on</span>
                <h1 class="text-lg font-bold text-gray-800 tracking-tight">申込期間・開講日設定</h1>
            </div>
            <p class="text-xs text-gray-500 ml-8">申込期間と、それに紐づく開講日、申込締切日を一元管理します</p>
        </header>

    <main class="max-w-4xl mx-auto px-4 py-8 space-y-8">
        
        <section class="bg-white rounded-2xl shadow-sm border border-slate-200">
			<div class="bg-gray-50/50 px-5 py-3 border-b border-gray-100 flex items-center justify-between">
                    <h2 class="text-sm font-bold text-gray-700 flex items-center gap-2">
                        <span class="material-symbols-outlined icon-md text-gray-400">add_circle</span>
                        新規申込期間を登録
                    </h2>
                </div>
            <div class="p-4 sm:p-6">
                <div class="grid grid-cols-1 md:grid-cols-[1fr_auto_auto_auto] gap-4 items-end">
                    <div class="flex flex-col space-y-1.5">
                        <label class="text-sm font-bold text-slate-600 ml-1">期間名称</label>
                        <input id="new-period-name" type="text" class="w-full h-10 rounded-lg border border-gray-300 bg-slate-50 px-4 text-sm focus:ring-2 focus:ring-blue-500 focus:bg-white outline-none transition-all" placeholder="例：2026年度 春期募集">
                    </div>
                    <div class="flex flex-col space-y-1.5">
                        <label class="text-sm font-bold text-slate-600 ml-1">受付開始</label>
                        <input id="new-period-from" type="date" class="h-10 rounded-lg border border-gray-300 bg-slate-50 px-4 text-sm focus:ring-2 focus:ring-blue-500 focus:bg-white outline-none transition-all">
                    </div>
                    <div class="flex flex-col space-y-1.5">
                        <label class="text-sm font-bold text-slate-600 ml-1">受付終了</label>
                        <input id="new-period-to" type="date" class="h-10 rounded-lg border border-gray-300 bg-slate-50 px-4 text-sm focus:ring-2 focus:ring-blue-500 focus:bg-white outline-none transition-all">
                    </div>
                    <button id="btn-add-period" class="h-10 px-6 bg-blue-600 text-white rounded-lg font-bold text-sm hover:bg-blue-700 transition-colors shadow-lg shadow-slate-200 flex items-center gap-2">
                        <span class="material-symbols-outlined text-sm">add</span>
                        期間を作成
                    </button>
                </div>
            </div>
        </section>

        <div class="space-y-4">
            <div class="flex items-center justify-between px-2">
                <h3 class="text-sm font-bold text-slate-500 flex items-center gap-2">
                    <span class="material-symbols-outlined text-sm">list_alt</span>
                    登録済みの期間一覧
                </h3>
                <span id="period-count-badge" class="text-xs px-2 py-0.5 bg-slate-200 text-slate-600 rounded-full font-bold">0件</span>
            </div>

            <div id="master-container" class="space-y-4">
                <div id="empty-state" class="py-20 text-center bg-white border-2 border-dashed border-slate-200 rounded-3xl">
                    <span class="material-symbols-outlined text-5xl text-slate-200 mb-4">folder_off</span>
                    <p class="text-slate-400 font-medium">期間が登録されていません。上のフォームから作成してください。</p>
                </div>
            </div>
        </div>
    </main>

    <div class="fixed bottom-0 inset-x-0 z-50 bg-white border-t border-gray-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
		<div class="mx-auto px-6 py-4 flex items-center justify-end gap-3">
			<button class="px-5 py-2.5 rounded-lg border border-gray-300 bg-white text-sm font-bold text-gray-600 hover:bg-gray-50 hover:text-gray-800 transition-colors">
				キャンセル
			</button>
			<button class="px-6 py-2.5 rounded-lg bg-blue-600 text-white text-sm font-bold hover:bg-blue-700 shadow-sm hover:shadow active:scale-[0.98] transition-all">
				登録する
			</button>
		</div>
	</div>

	<script>
	let periods = [];
	let activeAccordionId = null;

	const masterContainer = document.getElementById('master-container');
	const emptyState = document.getElementById('empty-state');
	const btnAddPeriod = document.getElementById('btn-add-period');
	const periodCountBadge = document.getElementById('period-count-badge');

	// 1. 申込期間の追加
	btnAddPeriod.addEventListener('click', () => {
	const nameInput = document.getElementById('new-period-name');
	const fromInput = document.getElementById('new-period-from');
	const toInput = document.getElementById('new-period-to');

	if (!nameInput.value || !fromInput.value || !toInput.value) {
		alert('名称と期間をすべて入力してください');
		return;
	}

	const newPeriod = {
		id: Date.now(),
		name: nameInput.value,
		from: fromInput.value,
		to: toInput.value,
		isEditing: false, // 期間自体の編集フラグ
		sessions: []
	};

	periods.push(newPeriod);
	activeAccordionId = newPeriod.id;

	nameInput.value = '';
	fromInput.value = '';
	toInput.value = '';
	render();
	});

	function render() {
	if (periods.length === 0) {
		emptyState.classList.remove('hidden');
		periodCountBadge.textContent = '0件';
		masterContainer.innerHTML = '';
		return;
	}

	emptyState.classList.add('hidden');
	periodCountBadge.textContent = `${periods.length}件`;
	masterContainer.innerHTML = '';

	periods.forEach(p => {
		masterContainer.appendChild(createPeriodCard(p));
	});
	}

	// 2. 申込期間カードの生成（編集モード対応）
	function createPeriodCard(period) {
	const isOpen = activeAccordionId === period.id;
	const div = document.createElement('div');
	div.className = `period-card bg-white border ${isOpen ? 'border-blue-500 ring-1 ring-blue-500' : 'border-slate-200'} rounded-2xl overflow-hidden shadow-sm transition-all mb-4`;

	// --- ヘッダー部分（通常表示 or 編集モード） ---
	let headerContent = '';
	if (period.isEditing) {
		// 【期間編集モード】
		headerContent = `
			<div class="p-4 flex flex-wrap items-end gap-3 bg-blue-50/50">
				<div class="flex-1 min-w-[200px] space-y-1">
					<label class="text-xs font-bold text-blue-600 ml-1">期間名称</label>
					<input type="text" id="edit-p-name-${period.id}" value="${period.name}" class="w-full h-9 rounded-lg border border-blue-300 px-3 text-sm outline-none focus:ring-2 focus:ring-blue-500">
				</div>
				<div class="flex flex-col space-y-1">
					<label class="text-xs font-bold text-blue-600 ml-1">開始</label>
					<input type="date" id="edit-p-from-${period.id}" value="${period.from}" class="h-9 rounded-lg border border-blue-300 px-3 text-sm outline-none focus:ring-2 focus:ring-blue-500">
				</div>
				<div class="flex flex-col space-y-1">
					<label class="text-xs font-bold text-blue-600 ml-1">終了</label>
					<input type="date" id="edit-p-to-${period.id}" value="${period.to}" class="h-9 rounded-lg border border-blue-300 px-3 text-sm outline-none focus:ring-2 focus:ring-blue-500">
				</div>
				<div class="flex gap-1">
					<button onclick="savePeriodEdit(${period.id})" class="h-9 px-3 bg-blue-600 text-white rounded-lg text-xs font-bold hover:bg-blue-700">保存</button>
					<button onclick="cancelPeriodEdit(${period.id})" class="h-9 px-3 bg-white border border-slate-200 text-slate-500 rounded-lg text-xs font-bold hover:bg-slate-50">戻る</button>
				</div>
			</div>
		`;
	} else {
		// 【通常表示モード】
		headerContent = `
			<div class="p-4 flex items-center gap-4 cursor-pointer hover:bg-slate-50/50 group" onclick="toggleAccordion(${period.id})">
				<div class="size-10 rounded-xl ${isOpen ? 'bg-blue-600 text-white' : 'bg-blue-50 text-blue-600'} flex items-center justify-center font-bold text-sm border border-blue-100 transition-all">
					${period.name.charAt(0)}
				</div>
				<div class="flex-1 min-w-0">
					<h4 class="font-bold text-slate-800 truncate">${period.name}</h4>
					<p class="text-[11px] font-mono text-slate-400 flex items-center gap-1">
						<span class="material-symbols-outlined text-[12px]">calendar_today</span>
						${period.from.replace(/-/g, '/')} - ${period.to.replace(/-/g, '/')}
					</p>
				</div>
				<div class="flex items-center gap-3">
					<button onclick="startPeriodEdit(${period.id})" class="opacity-0 group-hover:opacity-100 p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all" title="期間名を編集">
						<span class="material-symbols-outlined text-sm">edit_note</span>
					</button>
					<span class="material-symbols-outlined text-slate-300 transition-transform ${isOpen ? 'rotate-180' : ''}">expand_more</span>
				</div>
			</div>
		`;
	}

	div.innerHTML = `
		${headerContent}
		<div class="${isOpen ? '' : 'hidden'} border-t border-slate-100 bg-slate-50/30 p-4 sm:p-6 space-y-6 relative">
			<div class="absolute left-[27px] top-0 bottom-0 w-px border-l-2 border-dashed border-slate-200"></div>
			
			<div class="relative z-10 ml-10 bg-white p-4 rounded-xl border border-slate-200 shadow-sm space-y-3">
				<p class="text-[10px] font-bold text-blue-600 uppercase flex items-center gap-1"><span class="material-symbols-outlined text-[14px]">add_circle</span>新規日程を追加</p>
				<div class="grid grid-cols-1 sm:grid-cols-[1fr_1fr_auto] gap-3 items-end">
					<div class="flex flex-col space-y-1.5">
						<label class="text-xs font-bold text-slate-600 ml-1">開講日</label>
						<input type="date" id="open-${period.id}" class="h-9 rounded-lg border border-slate-200 px-3 text-xs outline-none focus:ring-2 focus:ring-blue-500 transition-all">
					</div>
					<div class="flex flex-col space-y-1.5">
						<label class="text-xs font-bold text-slate-600 ml-1">申込締切</label>
						<input type="date" id="limit-${period.id}" class="h-9 rounded-lg border border-slate-200 px-3 text-xs outline-none focus:ring-2 focus:ring-blue-500 transition-all">
					</div>
					<button onclick="addSession(${period.id})" class="h-9 px-4 bg-blue-600 text-white rounded-lg text-xs font-bold hover:bg-blue-700">追加</button>
				</div>
			</div>

			<div class="relative z-10 ml-10 space-y-2">
				${renderSessions(period)}
			</div>

			<div class="pt-4 flex justify-end border-t border-slate-100 relative z-10">
				<button onclick="deletePeriod(${period.id})" class="flex items-center gap-1 px-3 py-1.5 text-xs font-bold text-red-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors">
					<span class="material-symbols-outlined text-sm">delete</span> この申込期間を削除
				</button>
			</div>
		</div>
	`;
	return div;
	}

	// 3. 開講日（子要素）のレンダリング
	function renderSessions(period) {
	if (period.sessions.length === 0) return `<p class="text-[11px] text-slate-400 italic py-2">開講日が登録されていません。</p>`;
	return period.sessions.map(s => {
		if (s.isEditing) {
			return `
				<div class="flex items-center gap-3 bg-blue-50 border border-blue-200 p-3 rounded-xl animate-in fade-in duration-200">
					<div class="grid grid-cols-2 gap-3 flex-1">
						<input type="date" id="edit-open-${s.id}" value="${s.open}" class="w-full h-8 rounded border border-blue-300 px-2 text-xs">
						<input type="date" id="edit-limit-${s.id}" value="${s.limit}" class="w-full h-8 rounded border border-blue-300 px-2 text-xs">
					</div>
					<div class="flex gap-1">
						<button onclick="saveSessionEdit(${period.id}, ${s.id})" class="size-8 flex items-center justify-center bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-sm"><span class="material-symbols-outlined text-sm">check</span></button>
						<button onclick="cancelSessionEdit(${period.id}, ${s.id})" class="size-8 flex items-center justify-center bg-white text-slate-400 rounded-lg border border-slate-200"><span class="material-symbols-outlined text-sm">close</span></button>
					</div>
				</div>
			`;
		}
		return `
			<div class="group flex items-center justify-between bg-white border border-slate-200 p-3 rounded-xl hover:shadow-md hover:border-blue-200 transition-all">
				<div class="flex items-center gap-8">
					<div class="flex flex-col">
						<span class="text-xs font-bold text-slate-400 uppercase">開講日</span>
						<span class="text-xs font-bold font-mono text-slate-700">${s.open.replace(/-/g, '/')}</span>
					</div>
					<div class="flex flex-col border-l border-slate-100 pl-8">
						<span class="text-xs font-bold text-red-400 uppercase">申込締切</span>
						<span class="text-xs font-bold font-mono text-slate-500">${s.limit.replace(/-/g, '/')}</span>
					</div>
				</div>
				<div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-all">
					<button onclick="startSessionEdit(${period.id}, ${s.id})" class="size-8 flex items-center justify-center rounded-full text-slate-400 hover:text-blue-600 hover:bg-blue-50"><span class="material-symbols-outlined text-lg">edit</span></button>
					<button onclick="deleteSession(${period.id}, ${s.id})" class="size-8 flex items-center justify-center rounded-full text-slate-400 hover:text-red-500 hover:bg-red-50"><span class="material-symbols-outlined text-lg">delete</span></button>
				</div>
			</div>
		`;
	}).join('');
	}

	// 4. アクション関数群
	window.toggleAccordion = (id) => { activeAccordionId = (activeAccordionId === id) ? null : id; render(); };

	// --- 申込期間（親）の編集用 ---
	window.startPeriodEdit = (id) => {
	event.stopPropagation(); // アコーディオンが閉じるのを防ぐ
	const period = periods.find(p => p.id === id);
	period.isEditing = true;
	render();
	};
	window.cancelPeriodEdit = (id) => {
	const period = periods.find(p => p.id === id);
	period.isEditing = false;
	render();
	};
	window.savePeriodEdit = (id) => {
	const period = periods.find(p => p.id === id);
	period.name = document.getElementById(`edit-p-name-${id}`).value;
	period.from = document.getElementById(`edit-p-from-${id}`).value;
	period.to = document.getElementById(`edit-p-to-${id}`).value;
	period.isEditing = false;
	render();
	};

	// --- 開講日（子）の編集用 ---
	window.addSession = (periodId) => {
	const openVal = document.getElementById(`open-${periodId}`).value;
	const limitVal = document.getElementById(`limit-${periodId}`).value;
	if (!openVal || !limitVal) return alert('入力してください');
	periods.find(p => p.id === periodId).sessions.push({ id: Date.now(), open: openVal, limit: limitVal, isEditing: false });
	render();
	};
	window.startSessionEdit = (pId, sId) => {
	event.stopPropagation();
	periods.find(p => p.id === pId).sessions.forEach(s => s.isEditing = (s.id === sId));
	render();
	};
	window.saveSessionEdit = (pId, sId) => {
	const s = periods.find(p => p.id === pId).sessions.find(s => s.id === sId);
	s.open = document.getElementById(`edit-open-${sId}`).value;
	s.limit = document.getElementById(`edit-limit-${sId}`).value;
	s.isEditing = false;
	render();
	};
	window.cancelSessionEdit = (pId, sId) => {
	periods.find(p => p.id === pId).sessions.find(s => s.id === sId).isEditing = false;
	render();
	};

	// 削除系
	window.deleteSession = (pId, sId) => {
	event.stopPropagation();
	const p = periods.find(p => p.id === pId);
	p.sessions = p.sessions.filter(s => s.id !== sId);
	render();
	};
	window.deletePeriod = (id) => {
	event.stopPropagation();
	if (confirm('削除しますか？')) {
		periods = periods.filter(p => p.id !== id);
		if (activeAccordionId === id) activeAccordionId = null;
		render();
	}
	};

	render();
	</script>
</body>
</html>