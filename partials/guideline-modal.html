<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <title>募集要項登録</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="./css/base-style.css">
        
        <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
        <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

        <style>
            /* カスタムスクロールバー */
            ::-webkit-scrollbar { width: 6px; height: 6px; }
            ::-webkit-scrollbar-track { background: transparent; }
            ::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
            ::-webkit-scrollbar-thumb:hover { background-color: #94a3b8; }

            /* Quillのスタイル調整（SaaS風に馴染ませる） */
            .ql-toolbar.ql-snow {
                border-color: #d1d5db !important; /* border-gray-300 */
                border-top-left-radius: 0.5rem;
                border-top-right-radius: 0.5rem;
                background-color: #f9fafb; /* bg-gray-50 */
                padding: 8px !important;
            }
            .ql-container.ql-snow {
                border-color: #d1d5db !important;
                border-bottom-left-radius: 0.5rem;
                border-bottom-right-radius: 0.5rem;
                background-color: #fff;
                font-family: 'Noto Sans JP', sans-serif !important;
            }
            .ql-editor {
                min-height: 200px;
                font-size: 0.875rem; /* text-sm */
                line-height: 1.6;
                color: #374151; /* text-gray-700 */
            }
            .ql-editor.ql-blank::before {
                color: #9ca3af;
                font-style: normal;
            }
            
            /* Quill カスタムブロックのスタイル */
            .info-box {
                border-left: 4px solid #06b6d4; /* cyan-500 */
                background-color: #ecfeff; /* cyan-50 */
                padding: 1rem;
                margin: 1rem 0;
                border-radius: 0 0.375rem 0.375rem 0;
                font-weight: bold;
                color: #0e7490; /* cyan-700 */
            }
        </style>
    </head>
    <body class="bg-gray-50 text-gray-900 antialiased">
        <div class="min-h-dvh flex flex-col">
        
        <header class="sticky top-0 z-20 bg-white/95 backdrop-blur-sm border-b border-gray-100 px-6 py-4">
            <div class="flex items-center gap-2 mb-1">
                <span class="material-symbols-outlined text-blue-600">description</span>
                <h1 class="text-lg font-bold text-gray-800 tracking-tight">募集要項登録</h1>
            </div>
            <p class="text-xs text-gray-500 ml-8">本募集の募集要項（概要・ポリシー等）を登録してください。</p>
        </header>

        <main class="flex-1 px-6 py-6 space-y-8 pb-32">
            
            <section class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="bg-gray-50/50 px-5 py-3 border-b border-gray-100 flex items-center justify-between">
                <h2 class="text-sm font-bold text-gray-700 flex items-center gap-2">
                    <span class="material-symbols-outlined icon-md text-gray-400">badge</span>
                    基本情報
                </h2>
            </div>
            
            <div class="p-6 space-y-6">
                <div>
                    <div class="flex justify-between items-end mb-1.5">
                        <label for="title" class="text-sm font-bold text-gray-700">タイトル <span class="text-red-500">*</span></label>
                        <div class="text-xs text-gray-400 font-mono"><span id="titleCount">0</span>/60</div>
                    </div>
                    <input id="title" type="text" maxlength="60" class="h-10 block w-full rounded-md border border-gray-300 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50/50 transition-shadow hover:bg-white placeholder-gray-400" placeholder="例）2026年度 新入社員研修 募集要項" />
                    <p class="mt-1.5 text-xs text-gray-500">募集一覧カードや詳細ページのヘッダーに表示されます。</p>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1.5">サムネイル画像</label>
                    <div class="grid grid-cols-1 md:grid-cols-[1fr_240px] gap-6">
                        <div id="thumbDrop" class="group relative rounded-xl border-2 border-dashed border-gray-200 bg-gray-50 hover:bg-blue-50/50 hover:border-blue-300 transition-all p-6 flex flex-col items-center justify-center cursor-pointer min-h-[160px]">
                            <input id="thumbInput" type="file" accept="image/*" class="sr-only" />
                            <div class="text-center pointer-events-none">
                                <div class="bg-white p-2 rounded-full shadow-sm inline-flex mb-2 group-hover:scale-110 transition-transform">
                                    <span class="material-symbols-outlined text-2xl text-blue-500">add_photo_alternate</span>
                                </div>
                                <p class="text-sm font-medium text-gray-700">クリックしてアップロード</p>
                                <p class="text-xs text-gray-400 mt-1">または画像をドラッグ&ドロップ</p>
                                <p class="text-[10px] text-gray-400 mt-2">JPG / PNG / WebP（5MBまで）</p>
                            </div>
                            <div id="thumbDropMask" class="hidden absolute inset-0 rounded-xl bg-blue-500/10 ring-2 ring-blue-400 pointer-events-none"></div>
                        </div>

                        <div class="space-y-2">
                            <div class="relative w-full rounded-lg overflow-hidden bg-gray-100 border border-gray-200 shadow-inner aspect-[16/9] group">
                                <img id="thumbPreview" alt="" class="w-full h-full object-cover hidden" />
                                <div id="thumbEmpty" class="absolute inset-0 flex flex-col items-center justify-center text-gray-400">
                                    <span class="material-symbols-outlined text-3xl opacity-20">image</span>
                                    <span class="text-[10px] mt-1 opacity-50">プレビュー</span>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button id="thumbClearBtn" type="button" class="flex-1 h-8 rounded border border-gray-200 bg-white text-xs text-gray-600 hover:bg-red-50 hover:text-red-600 hover:border-red-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors" disabled>
                                    削除
                                </button>
                            </div>
                            <p id="thumbMeta" class="text-[10px] text-gray-400 truncate text-center h-4"></p>
                        </div>
                    </div>
                </div>
            </div>
            </section>

            <section class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="bg-gray-50/50 px-5 py-3 border-b border-gray-100 flex items-center justify-between">
                <h2 class="text-sm font-bold text-gray-700 flex items-center gap-2">
                    <span class="material-symbols-outlined icon-md text-gray-400">article</span>
                    募集詳細
                </h2>
                <div class="text-xs text-gray-400 font-mono"><span id="bodyCount">0</span>/2000</div>
                </div>
                
                <div class="p-6">
                    <p class="text-xs text-gray-500 mb-2">概要・対象・期間・費用・申込方法などを入力してください。</p>
                    <div id="editor-container-1"></div>
                </div>
            </section>

            <section class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="bg-gray-50/50 px-5 py-3 border-b border-gray-100 flex flex-col md:flex-row md:items-center justify-between gap-3">
                <h2 class="text-sm font-bold text-gray-700 flex items-center gap-2">
                    <span class="material-symbols-outlined icon-md text-gray-400">policy</span>
                    個人情報保護・キャンセル規定
                </h2>
                
                <div class="flex items-center gap-2 w-full md:w-auto">
                        <div class="relative flex-1 md:flex-none">
                            <select id="templateSelect" class="h-8 w-full md:w-48 rounded border border-gray-300 pl-2 pr-8 text-xs focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white appearance-none cursor-pointer">
                                <option value="">テンプレートを選択...</option>
                                <option value="opt-1">A：キャンセル可能（通常）</option>
                                <option value="opt-2">B：キャンセル不可（厳格）</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
                                <span class="material-symbols-outlined text-gray-400 icon-sm">expand_more</span>
                            </div>
                        </div>
                        <button id="applyTemplateBtn" class="h-8 px-3 rounded bg-white border border-gray-300 text-xs font-bold text-gray-600 hover:bg-gray-50 hover:text-blue-600 active:scale-[0.98] transition-all flex items-center gap-1">
                            <span class="material-symbols-outlined icon-sm">content_paste</span>
                            反映
                        </button>
                </div>
                </div>
                
                <div class="p-6">
                    <div class="flex justify-between items-end mb-2">
                        <p class="text-xs text-gray-500">トラブル防止のため、キャンセル時の対応や個人情報の取り扱いについて明記してください。</p>
                        <div class="text-xs text-gray-400 font-mono"><span id="bodyCount2">0</span>/2000</div>
                    </div>
                    <div id="editor-container-2"></div>
                </div>
            </section>

        </main>

        <div class="fixed bottom-0 inset-x-0 z-50 bg-white border-t border-gray-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
            <div class="mx-auto px-6 py-4 flex items-center justify-end gap-3">
            <button class="px-5 py-2.5 rounded-lg border border-gray-300 bg-white text-sm font-bold text-gray-600 hover:bg-gray-50 hover:text-gray-800 transition-colors">
                キャンセル
            </button>
            <button onclick="submitMock()" class="px-6 py-2.5 rounded-lg bg-blue-600 text-white text-sm font-bold hover:bg-blue-700 shadow-sm hover:shadow active:scale-[0.98] transition-all flex items-center">
                <span>登録する</span>
            </button>
            </div>
        </div>
        </div>

        <script>
            // --- Quill設定: カスタムブロック ---
            const Block = Quill.import('blots/block');
            class InfoBox extends Block {
                static create(value) {
                    const node = super.create();
                    node.setAttribute('class', 'info-box');
                    return node;
                }
            }
            InfoBox.blotName = 'info-box';
            InfoBox.tagName = 'div';
            Quill.register(InfoBox);

            // --- Quill設定: ツールバー ---
            const toolbarOptions = {
                container: [
                    [{ 'header': [2, 3, false] }],
                    ['bold', 'underline', 'strike'],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    [{ 'color': [] }, { 'background': [] }],
                    ['info-box'], // カスタムボタン
                    ['link', 'clean']
                ],
                handlers: {
                    'info-box': function() {
                        this.quill.format('info-box', true);
                    }
                }
            };

            // エディタの初期化
            const quill1 = new Quill('#editor-container-1', {
                theme: 'snow',
                modules: { toolbar: toolbarOptions },
                placeholder: 'ここ詳細内容を入力...'
            });

            const quill2 = new Quill('#editor-container-2', {
                theme: 'snow',
                modules: { toolbar: toolbarOptions },
                placeholder: 'キャンセル規定などを入力...'
            });
            
            // --- 文字数カウント ---
            const titleEl = document.getElementById('title');
            const titleCount = document.getElementById('titleCount');
            const bodyCount = document.getElementById('bodyCount');
            const bodyCount2 = document.getElementById('bodyCount2');

            titleEl.addEventListener('input', () => {
                titleCount.textContent = titleEl.value.length;
            });

            quill1.on('text-change', () => {
                const text = quill1.getText();
                // 改行のみの場合は0とする
                const length = text === '\n' ? 0 : text.length - 1; 
                bodyCount.textContent = Math.max(0, length);
            });

            quill2.on('text-change', () => {
                const text = quill2.getText();
                const length = text === '\n' ? 0 : text.length - 1;
                bodyCount2.textContent = Math.max(0, length);
            });

            // --- テンプレート挿入 ---
            const templateSelect = document.getElementById('templateSelect');
            const applyTemplateBtn = document.getElementById('applyTemplateBtn');
            const templates = {
                'opt-1': `<h3>キャンセルポリシー（通常）</h3><p>開催日の<strong>3日前</strong>まではキャンセル料は発生しません。それ以降は参加費の100%を申し受けます。</p><ul><li>連絡なしの不参加：100%</li><li>当日キャンセル：100%</li></ul>`,
                'opt-2': `<h3>キャンセルポリシー（厳格）</h3><p>お申し込み完了後の<span style="color: #ef4444;">キャンセル・返金は一切できません</span>のでご注意ください。</p><p>代理の方の参加は可能です。</p>`
            };

            applyTemplateBtn.addEventListener('click', () => {
                const val = templateSelect.value;
                if(!val) return;
                // エディタの内容を上書き
                quill2.root.innerHTML = templates[val];
            });

            // --- サムネイル画像処理 ---
            const drop = document.getElementById('thumbDrop');
            const dropMask = document.getElementById('thumbDropMask');
            const input = document.getElementById('thumbInput');
            const clearBtn = document.getElementById('thumbClearBtn');
            const preview = document.getElementById('thumbPreview');
            const empty = document.getElementById('thumbEmpty');
            const meta = document.getElementById('thumbMeta');
            const MAX_MB = 5;

            function setPreview(file){
                if(!file) return;
                if(!file.type.startsWith('image/')){ alert('画像ファイルを選択してください'); return; }
                if(file.size > MAX_MB*1024*1024){ alert(`サイズが大きすぎます（${MAX_MB}MBまで）`); return; }

                const url = URL.createObjectURL(file);
                preview.src = url; 
                preview.classList.remove('hidden'); 
                empty.classList.add('hidden');
                clearBtn.disabled = false;
                meta.textContent = `${file.name} (${(file.size/1024/1024).toFixed(2)}MB)`;
            }

            function clearPreview(){
                preview.removeAttribute('src'); 
                preview.classList.add('hidden'); 
                empty.classList.remove('hidden');
                input.value = ''; 
                meta.textContent = ''; 
                clearBtn.disabled = true;
            }

            drop.addEventListener('click', () => input.click());
            input.addEventListener('change', (e) => setPreview(e.target.files?.[0]));
            
            ['dragenter','dragover'].forEach(ev => drop.addEventListener(ev, (e)=>{e.preventDefault(); dropMask.classList.remove('hidden');}));
            ['dragleave','drop'].forEach(ev => drop.addEventListener(ev, (e)=>{e.preventDefault(); dropMask.classList.add('hidden');}));
            drop.addEventListener('drop', (e)=>{
                const file = e.dataTransfer.files?.[0]; 
                if(file) setPreview(file);
            });
            clearBtn.addEventListener('click', (e) => { e.stopPropagation(); clearPreview(); });

            // --- 送信モック ---
            function submitMock() {
                const data = {
                    title: titleEl.value,
                    bodyHTML: quill1.root.innerHTML,
                    policyHTML: quill2.root.innerHTML,
                    image: input.files[0]?.name || null
                };
                console.log('送信データ:', data);
                alert('コンソールに送信データを出力しました。');
            }
        </script>
    </body>
</html>