<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>パーソナリティ診断</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <style>
    body {
      font-family: "游ゴシック体", "Yu Gothic", "游ゴシック", YuGothic, sans-serif;
      background: linear-gradient(to bottom right, #dbeafe, #fef9c3);
      min-height: 100vh;
    }
    .fade-in { animation: fadeIn 0.6s ease-in-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body class="flex items-center justify-center p-6">

  <div id="app" class="w-full max-w-xl bg-white/80 backdrop-blur-md shadow-2xl rounded-2xl p-8">
    <h1 class="text-3xl font-bold text-center mb-6 text-gray-800">パーソナリティ診断</h1>

    <!-- プログレスバー -->
    <div id="progress-bar-wrapper" class="hidden mb-6">
      <div class="w-full bg-gray-200 rounded-full h-3">
        <div id="progress-bar" class="h-3 bg-blue-500 rounded-full transition-all duration-300"></div>
      </div>
      <p id="progress-text" class="text-sm text-gray-600 mt-2 text-center"></p>
    </div>

    <!-- 質問エリア -->
    <div id="question-container" class="space-y-6 fade-in"></div>

    <!-- 結果表示エリア -->
    <div id="result" class="hidden text-center fade-in">
      <div class="bg-gradient-to-br from-blue-100 to-indigo-50 rounded-2xl shadow-lg p-6 mt-4">
        <span id="result-icon" class="material-symbols-outlined text-6xl text-blue-600 mb-4">psychology</span>
        <h2 class="text-2xl font-semibold mb-2 text-gray-800">診断結果</h2>
        <p id="result-text" class="text-lg text-gray-700 mb-4"></p>
        <div id="result-card" class="bg-white border border-gray-200 rounded-xl p-5 text-left text-gray-700 shadow-inner mb-6">
          <p id="result-detail" class="leading-relaxed"></p>
          <canvas id="result-chart" class="mt-6"></canvas>
        </div>
        <button id="share-btn" class="mt-3 px-4 py-2 bg-sky-500 text-white rounded-lg hover:bg-sky-600 transition-all">
          <span class="material-symbols-outlined align-middle mr-1">share</span> 結果をシェアする
        </button>
      </div>
      <button onclick="restartTest()" class="mt-8 px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-all">
        もう一度やる
      </button>
    </div>

    <!-- 開始ボタン -->
    <div id="start-container" class="text-center mt-6">
      <button onclick="startTest()" class="px-8 py-3 bg-blue-600 text-white font-semibold rounded-xl shadow-md hover:bg-blue-700 transition-all">
        診断をはじめる
      </button>
    </div>
  </div>

  <script>
    const questions = [
      { text: "初対面の人と話すのが楽しい。", type: "E" },
      { text: "一人で過ごす時間を大切にしている。", type: "I" },
      { text: "計画的に行動するのが得意だ。", type: "J" },
      { text: "流れに任せて動くことが多い。", type: "P" },
      { text: "チームをまとめることにやりがいを感じる。", type: "E" },
      { text: "思いついたらすぐ行動に移す。", type: "P" },
      { text: "ルールや順序を重んじる。", type: "J" },
      { text: "感情よりも論理で判断する。", type: "I" },
    ];

    const choices = [
      { label: "とてもあてはまる", value: 2 },
      { label: "あてはまる", value: 1 },
      { label: "どちらでもない", value: 0 },
      { label: "あてはまらない", value: -1 },
      { label: "とてもあてはまらない", value: -2 },
    ];

    let current = 0;
    const scores = { E: 0, I: 0, J: 0, P: 0 };
    let chartInstance = null;

    function startTest() {
      document.getElementById("start-container").classList.add("hidden");
      document.getElementById("progress-bar-wrapper").classList.remove("hidden");
      showQuestion();
      updateProgress();
    }

    function showQuestion() {
      const container = document.getElementById("question-container");
      container.innerHTML = "";

      if (current >= questions.length) {
        showResult();
        return;
      }

      const q = questions[current];
      const name = `q-${current}`; // ラジオのnameは質問ごとに
      const qEl = document.createElement("div");
      qEl.classList.add("fade-in");
      qEl.innerHTML = `
        <p class="text-lg font-medium mb-6 text-center text-gray-800">Q${current + 1}. ${q.text}</p>

        <fieldset class="grid grid-cols-1 sm:grid-cols-5 gap-3" role="radiogroup" aria-label="回答を選択">
          ${choices.map((c, i) => `
            <label class="block">
              <input type="radio" class="peer sr-only" name="${name}" value="${c.value}" />
              <div class="h-full border border-gray-300 rounded-xl p-4 bg-white shadow-sm transition-all
                          hover:shadow-md hover:border-blue-400
                          peer-checked:border-blue-500 peer-checked:bg-blue-50 peer-checked:shadow-md">
                <p class="text-sm font-medium text-gray-700 text-center">${c.label}</p>
              </div>
            </label>
          `).join("")}
        </fieldset>
      `;
      container.appendChild(qEl);

      // 選択時に前へ進む（キーボード操作も可）
      container.querySelectorAll(`input[name="${name}"]`).forEach(input => {
        input.addEventListener("change", (e) => {
          const value = Number(e.target.value);
          setTimeout(() => answer(value), 200);
        });
      });
    }

    function answer(value) {
      const type = questions[current].type;
      scores[type] += value;
      current++;
      updateProgress();
      showQuestion();
    }

    function updateProgress() {
      const progress = Math.round((current / questions.length) * 100);
      document.getElementById("progress-bar").style.width = `${progress}%`;
      document.getElementById("progress-text").textContent = `${current}/${questions.length} 問完了`;
    }

    function showResult() {
      document.getElementById("question-container").classList.add("hidden");
      document.getElementById("progress-bar-wrapper").classList.add("hidden");
      const result = document.getElementById("result");
      result.classList.remove("hidden");

      const eScore = scores.E - scores.I;
      const jScore = scores.J - scores.P;
      let resultText, resultDetail, icon;

      if (eScore > 0 && jScore > 0) {
        resultText = "リーダータイプ";
        resultDetail = "周囲を引っ張る力と計画性を兼ね備えたタイプ。チームをまとめることが得意で、目標達成に強い意欲を持っています。";
        icon = "military_tech";
      } else if (eScore > 0 && jScore <= 0) {
        resultText = "ムードメーカータイプ";
        resultDetail = "人との関わりを楽しみ、柔軟な発想で場を明るくするタイプ。新しいアイデアを次々と生み出します。";
        icon = "emoji_people";
      } else if (eScore <= 0 && jScore > 0) {
        resultText = "職人気質タイプ";
        resultDetail = "一人でコツコツと努力し、精度の高い仕事をするタイプ。信頼される堅実な存在です。";
        icon = "handyman";
      } else {
        resultText = "探求者タイプ";
        resultDetail = "自分のペースで深く物事を考えるタイプ。新しい知識を吸収し、独自の視点を持ちます。";
        icon = "search";
      }

      document.getElementById("result-text").textContent = `あなたは「${resultText}」です！`;
      document.getElementById("result-detail").textContent = resultDetail;
      document.getElementById("result-icon").textContent = icon;

      drawChart();
      setupShareButton(resultText);
    }

    function drawChart() {
      const ctx = document.getElementById("result-chart").getContext("2d");
      if (chartInstance) chartInstance.destroy();

      chartInstance = new Chart(ctx, {
        type: "radar",
        data: {
          labels: ["外向性(E)", "内向性(I)", "計画性(J)", "柔軟性(P)"],
          datasets: [{
            label: "あなたの傾向",
            data: [scores.E, scores.I, scores.J, scores.P],
            backgroundColor: "rgba(59,130,246,0.2)",
            borderColor: "#3b82f6",
            borderWidth: 2,
            pointBackgroundColor: "#3b82f6"
          }]
        },
        options: {
          scales: {
            r: {
              suggestedMin: -4,
              suggestedMax: 4,
              ticks: { stepSize: 2 },
              pointLabels: { font: { size: 12 } }
            }
          },
          plugins: { legend: { display: false } }
        }
      });
    }

    function setupShareButton(resultText) {
      const shareBtn = document.getElementById("share-btn");
      shareBtn.onclick = () => {
        const text = `私は「${resultText}」タイプでした！ #パーソナリティ診断`;
        const url = encodeURIComponent(window.location.href);
        const tweetUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${url}`;
        window.open(tweetUrl, "_blank");
      };
    }

    function restartTest() {
      current = 0;
      Object.keys(scores).forEach(k => scores[k] = 0);
      document.getElementById("question-container").classList.remove("hidden");
      document.getElementById("result").classList.add("hidden");
      document.getElementById("progress-bar-wrapper").classList.remove("hidden");
      showQuestion();
      updateProgress();
    }
  </script>

</body>
</html>
