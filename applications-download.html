<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <title>申込ダウンロード - New SD App</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nouislider@15.7.0/dist/nouislider.min.css">
        <script src="https://cdn.jsdelivr.net/npm/nouislider@15.7.0/dist/nouislider.min.js"></script>
        <script type="module" src="../js/modules/dashboard/index.js"></script>
        <script src="./js/role-visibility.js" defer></script>
        <script src="./js/mock-ui.js" defer></script>
        <script src="./js/modal-iframe.js"></script>
        <style>
            /* 全体のフォント設定 */
            body {
                font-family: 'Noto Sans JP', sans-serif;
            }
            /* アイコン設定 */
            .material-symbols-outlined {
                font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            }
            .icon-sm { font-size: 1.125rem !important; } /* 18px */
            .icon-md { font-size: 1.25rem !important; }  /* 20px */

            /* UX改善: スクロールバー */
            .custom-scrollbar::-webkit-scrollbar {
                width: 6px;
                height: 6px;
            }
            .custom-scrollbar::-webkit-scrollbar-track {
                background: transparent;
            }
            .custom-scrollbar::-webkit-scrollbar-thumb {
                background-color: #cbd5e1; /* slate-300 */
                border-radius: 20px;
            }
            .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                background-color: #94a3b8; /* slate-400 */
            }
        </style>
    </head>
    <body class="bg-gray-50 h-screen overflow-hidden flex flex-col text-gray-900 antialiased">
        <div id="app-header" class="sticky top-0 z-50 shadow-sm bg-white"></div>
        <main class="flex flex-1 min-h-0 overflow-hidden">
            <div id="app-sidebar"></div>
            
            <div class="flex-1 overflow-y-auto custom-scrollbar p-8 bg-gray-50">
                <div class="max-w-6xl mx-auto flex flex-col gap-6 pb-12">
                    
                    <div class="flex items-start justify-between">
                        <div>
                            <h1 class="text-2xl font-bold text-gray-800 tracking-tight flex items-center gap-2 mb-1">
                                申込ダウンロード
                            </h1>
                            <p class="text-sm text-gray-500">
                                開講日ベースでダウンロード可能なデータを取得します。
                            </p>
                        </div>
                    </div>

                    <section class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 space-y-4">
                        <div class="flex flex-wrap items-center justify-between gap-3 border-b border-gray-100 pb-4">
                            <div class="flex items-center gap-2 text-sm font-bold text-gray-700">
                                <span class="material-symbols-outlined icon-md text-gray-400">tune</span>
                                <span>フィルタ条件</span>
                            </div>
                            <div class="flex items-center gap-2 text-xs text-orange-600 bg-orange-50 px-3 py-1 rounded-md border border-orange-100">
                                <span class="material-symbols-outlined icon-sm">info</span>
                                ログインユーザーの所属企業と担当情報に基づきリストは自動調整されます
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="flex flex-col gap-2">
                                <label for="search-text" class="text-xs text-gray-500 uppercase tracking-wide">検索（顧客名・募集名）</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                        <span class="material-symbols-outlined text-gray-400 icon-sm">search</span>
                                    </div>
                                    <input id="search-text" type="text"
                                        placeholder="キーワードを入力..."
                                        class="h-10 block w-full rounded-md border border-gray-300 pl-10 pr-3 text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-shadow bg-gray-50/50" />
                                </div>
                            </div>

                            <div class="flex flex-col gap-2">
                                <label for="filter-status" class="text-xs text-gray-500 uppercase tracking-wide">ステータス</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                        <span class="material-symbols-outlined text-gray-400 icon-sm">filter_list</span>
                                    </div>
                                    <select id="filter-status"
                                            class="h-10 block w-full rounded-md border border-gray-300 pl-10 pr-8 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-shadow bg-gray-50/50 appearance-none">
                                        <option value="all">すべて表示</option>
                                        <option value="DL可能">DL可能のみ</option>
                                        <option value="DL不可">DL不可のみ</option>
                                    </select>
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
                                        <span class="material-symbols-outlined text-gray-400 icon-sm">expand_more</span>
                                    </div>
                                </div>
                            </div>

                            <!-- <div class="flex flex-col gap-2">
                                <span class="text-xs font-bold text-gray-500 uppercase tracking-wide">開講日順（昇順）</span>
                                <div class="text-xs text-gray-400 bg-gray-50 border border-gray-100 rounded-md p-2.5 flex items-start gap-2 h-[38px] items-center">
                                    <span class="material-symbols-outlined icon-sm">calendar_month</span>
                                    将来的に期間指定フィルタを追加可能
                                </div>
                            </div> -->
                        </div>

                        <div class="flex items-center justify-end pt-2">
                            <span id="result-count-label" class="text-xs font-medium text-gray-500 bg-gray-100 px-3 py-1 rounded-full">0件のデータ</span>
                        </div>
                    </section>

                    <section class="space-y-4">
                        <div class="flex items-center justify-between px-1">
                            <h2 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                                <span class="material-symbols-outlined text-gray-500">table_rows</span>
                                ダウンロード対象一覧
                            </h2>
                        </div>

                        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                            <table class="w-full text-sm text-left">
                                <thead class="bg-gray-50/80 border-b border-gray-200 text-xs text-gray-500 uppercase tracking-wider">
                                    <tr>
                                        <th class="px-6 py-3 font-semibold">開講日</th>
                                        <th class="px-6 py-3 font-semibold">申込締切</th>
                                        <th class="px-6 py-3 font-semibold">顧客名</th>
                                        <th class="px-6 py-3 font-semibold">募集名</th>
                                        <th class="px-6 py-3 font-semibold">ステータス</th>
                                        <th class="px-6 py-3 font-semibold text-center">アクション</th>
                                    </tr>
                                </thead>
                                <tbody id="download-rows" class="divide-y divide-gray-100">
                                    </tbody>
                            </table>
                        </div>
                    </section>
                </div>
            </div>
        </main>
    </body>
</html>
<script>
    window.addEventListener('DOMContentLoaded', () => {
    // 初期ロールやブランド名・ユーザー名は自由に
    MockUI.injectHeader('#app-header', {
        userName: 'Test User',
        brand: 'New SD App',
        initialRole: 'iec', // 初回roleが未指定ならiecをセット
    });
    MockUI.injectSidebar('#app-sidebar');

    // サイドバー挿入直後に data-visible-for を反映
    RoleMock.applyRoleVisibility();

    // モーダル初期化（1回だけ）
    ModalIframe.init();
  });
    // ====== モックデータ ======
    // 1レコード = 1 募集（顧客×募集×開講日）として想定
    const DOWNLOAD_ITEMS = [
      {
        id: "d001",
        openingDate: "2026/06/01",
        deadlineDate: "2026/05/20",
        customerName: "株式会社アルファ",
        recruitmentName: "2026年度上期 SD募集",
        status: "DL可能"
      },
      {
        id: "d002",
        openingDate: "2026/07/01",
        deadlineDate: "2026/06/10",
        customerName: "株式会社アルファ",
        recruitmentName: "2026年度上期 SD募集",
        status: "DL可能"
      },
      {
        id: "d003",
        openingDate: "2026/07/01",
        deadlineDate: "2026/06/15",
        customerName: "株式会社ベータ",
        recruitmentName: "FY26 SD募集",
        status: "DL不可"
      },
      {
        id: "d004",
        openingDate: "2026/12/01",
        deadlineDate: "2026/11/10",
        customerName: "株式会社シグマ",
        recruitmentName: "2026年度下期",
        status: "DL可能"
      },
      {
        id: "d005",
        openingDate: "2027/01/05",
        deadlineDate: "2026/12/20",
        customerName: "株式会社デルタ",
        recruitmentName: "FY26 冬募集",
        status: "DL不可"
      }
    ];

    // ====== DOM ======
    const rowsBody        = document.getElementById("download-rows");
    const searchInput     = document.getElementById("search-text");
    const statusSelect    = document.getElementById("filter-status");
    const resultCountLabel= document.getElementById("result-count-label");

    let currentSearchText = "";
    let currentStatus     = "all";

    // ====== ユーティリティ ======
    function parseDate(str) {
      // "YYYY/MM/DD" を Date に変換
      const [y, m, d] = str.split("/").map(n => parseInt(n, 10));
      return new Date(y, m - 1, d);
    }

    function getFilteredItems() {
      const text = currentSearchText.trim().toLowerCase();
      return DOWNLOAD_ITEMS
        .filter(item => {
          if (currentStatus !== "all" && item.status !== currentStatus) return false;
          if (!text) return true;
          const haystack = (item.customerName + " " + item.recruitmentName).toLowerCase();
          return haystack.includes(text);
        })
        .sort((a, b) => {
          // 開講日昇順
          return parseDate(a.openingDate) - parseDate(b.openingDate);
        });
    }

    function renderList() {
      const items = getFilteredItems();
      rowsBody.innerHTML = "";

      resultCountLabel.textContent = `${items.length}件のデータ`;

      if (items.length === 0) {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="p-12 text-center text-gray-400" colspan="6">
            <div class="flex flex-col items-center gap-2">
                <span class="material-symbols-outlined text-4xl text-gray-300">search_off</span>
                <span class="text-sm font-medium">条件に一致するデータがありません</span>
            </div>
          </td>
        `;
        rowsBody.appendChild(tr);
        return;
      }

      items.forEach(item => {
        const isAvailable = item.status === "DL可能";
        
        // デザイン調整: Badge style match media-plan-list (squared rounded-md/sm usually)
        const badgeClass = isAvailable
          ? "bg-blue-50 text-blue-700 border border-blue-100"
          : "bg-gray-100 text-gray-500 border border-gray-200";
        const dotClass = isAvailable ? "bg-blue-500" : "bg-gray-400";

        const tr = document.createElement("tr");
        tr.className = "hover:bg-gray-50 transition-colors group";
        tr.innerHTML = `
          <td class="px-6 py-4 align-middle text-sm text-gray-600">
            <span class="font-bold text-gray-800">${item.openingDate}</span>
          </td>
          <td class="px-6 py-4 align-middle text-sm text-gray-600">
            ${item.deadlineDate}
          </td>
          <td class="px-6 py-4 align-middle text-sm font-medium text-gray-800">
            ${item.customerName}
          </td>
          <td class="px-6 py-4 align-middle text-sm text-gray-600">
            ${item.recruitmentName}
          </td>
          <td class="px-6 py-4 align-middle">
            <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded text-xs font-medium ${badgeClass}">
              <span class="w-1.5 h-1.5 rounded-full ${dotClass}"></span>
              ${item.status}
            </span>
          </td>
          <td class="px-6 py-4 align-middle text-center">
            <button
              class="inline-flex items-center gap-1 px-4 py-2 rounded-md text-xs font-bold transition-all shadow-sm
                     ${isAvailable
                      ? "bg-blue-600 text-white hover:bg-blue-700 hover:shadow"
                      : "bg-gray-100 text-gray-400 border border-gray-200 cursor-not-allowed"}"
              data-download-id="${item.id}"
              ${isAvailable ? "" : "disabled"}
            >
              <span class="material-symbols-outlined icon-sm">
                ${isAvailable ? "download" : "block"}
              </span>
              ${isAvailable ? "ダウンロード" : "DL不可"}
            </button>
          </td>
        `;
        rowsBody.appendChild(tr);
      });

      // クリックイベント（モック）
      rowsBody.querySelectorAll("button[data-download-id]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-download-id");
          const target = DOWNLOAD_ITEMS.find(x => x.id === id);
          if (!target || target.status !== "DL可能") return;

          // 実装時はここでファイルDL API呼び出しなど
          alert(`モック：${target.customerName}「${target.recruitmentName}」（開講日: ${target.openingDate}）のデータをダウンロードします。`);
        });
      });
    }

    // ====== 初期化 ======
    document.addEventListener("DOMContentLoaded", () => {
      renderList();

      searchInput.addEventListener("input", () => {
        currentSearchText = searchInput.value;
        renderList();
      });

      statusSelect.addEventListener("change", () => {
        currentStatus = statusSelect.value;
        renderList();
      });
    });
  </script>