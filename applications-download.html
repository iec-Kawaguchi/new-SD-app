<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <title>New SD App</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nouislider@15.7.0/dist/nouislider.min.css">
        <script src="https://cdn.jsdelivr.net/npm/nouislider@15.7.0/dist/nouislider.min.js"></script>
        <script type="module" src="../js/modules/dashboard/index.js"></script>
        <script src="./js/role-visibility.js" defer></script>
        <script src="./js/mock-ui.js" defer></script>
        <script src="./js/modal-iframe.js"></script>
        <style>
            body {
                font-family: "游ゴシック体", "Yu Gothic", "游ゴシック", YuGothic, sans-serif;
            }
            /* スクロール可能だがスクロールバーを非表示 */
            .no-scrollbar {
              scrollbar-width: none; /* Firefox */
              -ms-overflow-style: none; /* IE/Edge */
            }
            .no-scrollbar::-webkit-scrollbar {
              display: none; /* Chrome/Safari */
            }
        </style>
    </head>
    <body class="bg-gray-100 h-screen overflow-hidden flex flex-col">
        <div id="app-header" class="sticky"></div>
        <main class="flex flex-1 min-h-0">
            <div id="app-sidebar"></div>
            <!-- メイン背景 -->
            <div class="min-h-dvh p-6 space-y-6 bg-gray-200 w-full">
                <!-- ヘッダー -->
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-blue-700">download</span>
                        <div>
                            <h1 class="text-xl font-bold">申込ダウンロード</h1>
                            <p class="text-xs text-gray-500">
                                全顧客・募集を横断して、開講日ベースでダウンロード可能なデータを取得します。
                            </p>
                        </div>
                    </div>
                </div>

                <!-- フィルタバー -->
                <section class="bg-white rounded-xl shadow p-4 space-y-3">
                    <div class="flex flex-wrap items-center justify-between gap-3">
                        <div class="flex items-center gap-2 text-xs text-gray-500">
                        <span class="material-symbols-outlined text-[18px] text-gray-400">tune</span>
                        <span>フィルタ</span>
                        </div>
                        <div class="flex items-center gap-2 text-xs text-red-500">
                            ログインユーザーの所属企業と担当情報からリストの表示は調整
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-sm">
                        <!-- キーワード検索 -->
                        <div class="flex flex-col gap-1">
                            <label for="search-text" class="text-xs text-gray-500">検索（顧客名・募集名）</label>
                            <div class="flex items-center gap-2 px-3 py-1.5 rounded-full border border-gray-300 bg-gray-50">
                                <span class="material-symbols-outlined text-gray-400 text-sm">search</span>
                                <input id="search-text" type="text"
                                    placeholder="顧客名 / 募集名で絞り込み"
                                    class="flex-1 bg-transparent text-sm focus:outline-none" />
                            </div>
                        </div>

                        <!-- ステータス -->
                        <div class="flex flex-col gap-1">
                        <label for="filter-status" class="text-xs text-gray-500">ステータス</label>
                        <div class="flex items-center gap-2 px-3 py-1.5 rounded-full border border-gray-300 bg-gray-50">
                            <span class="material-symbols-outlined text-gray-400 text-sm">check_circle</span>
                            <select id="filter-status"
                                    class="flex-1 bg-transparent text-sm focus:outline-none">
                            <option value="all">すべて</option>
                            <option value="DL可能">DL可能のみ</option>
                            <option value="DL不可">DL不可のみ</option>
                            </select>
                        </div>
                        </div>

                            <!-- 開講日のメモ（将来的に範囲フィルタ追加してもOKなスペース） -->
                            <div class="flex flex-col gap-1">
                                <span class="text-xs text-gray-500">開講日</span>
                                <span class="text-xs text-gray-600">
                                    表示は開講日（昇順）です。将来的に範囲指定フィルタを追加するスペースとして利用可能。
                                </span>
                            </div>
                    </div>

                <div class="flex items-center justify-between text-xs text-gray-500 pt-1">
                    <span id="result-count-label">0件のデータ</span>
                </div>
                </section>

                <!-- リスト -->
                <section class="space-y-3">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-semibold flex items-center gap-1">
                    <span class="material-symbols-outlined text-gray-500">table</span>
                    ダウンロード対象一覧
                    </h2>
                </div>

                <div class="bg-white rounded-xl shadow overflow-hidden">
                    <table class="w-full text-sm text-left">
                    <thead class="bg-gray-100 text-xs">
                        <tr>
                        <th class="p-3 font-semibold">開講日</th>
                        <th class="p-3 font-semibold">申込締切</th>
                        <th class="p-3 font-semibold">顧客名</th>
                        <th class="p-3 font-semibold">募集名</th>
                        <th class="p-3 font-semibold">ステータス</th>
                        <th class="p-3 font-semibold text-center ">ダウンロード</th>
                        </tr>
                    </thead>
                    <tbody id="download-rows">
                        <!-- JSで埋め込み -->
                    </tbody>
                    </table>
                </div>
                </section>
            </div>
        </main>
    </body>
</html>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
    // 初期ロールやブランド名・ユーザー名は自由に
    MockUI.injectHeader('#app-header', {
        userName: 'Test User',
        brand: 'New SD App',
        initialRole: 'iec', // 初回roleが未指定ならiecをセット
    });
    MockUI.injectSidebar('#app-sidebar');

    // サイドバー挿入直後に data-visible-for を反映
    RoleMock.applyRoleVisibility();

    // モーダル初期化（1回だけ）
    ModalIframe.init();
  });
    // ====== モックデータ ======
    // 1レコード = 1 募集（顧客×募集×開講日）として想定
    const DOWNLOAD_ITEMS = [
      {
        id: "d001",
        openingDate: "2026/06/01",
        deadlineDate: "2026/05/20",
        customerName: "株式会社アルファ",
        recruitmentName: "2026年度上期 SD募集",
        status: "DL可能"
      },
      {
        id: "d002",
        openingDate: "2026/07/01",
        deadlineDate: "2026/06/10",
        customerName: "株式会社アルファ",
        recruitmentName: "2026年度上期 SD募集",
        status: "DL可能"
      },
      {
        id: "d003",
        openingDate: "2026/07/01",
        deadlineDate: "2026/06/15",
        customerName: "株式会社ベータ",
        recruitmentName: "FY26 SD募集",
        status: "DL不可"
      },
      {
        id: "d004",
        openingDate: "2026/12/01",
        deadlineDate: "2026/11/10",
        customerName: "株式会社シグマ",
        recruitmentName: "2026年度下期",
        status: "DL可能"
      },
      {
        id: "d005",
        openingDate: "2027/01/05",
        deadlineDate: "2026/12/20",
        customerName: "株式会社デルタ",
        recruitmentName: "FY26 冬募集",
        status: "DL不可"
      }
    ];

    // ====== DOM ======
    const rowsBody        = document.getElementById("download-rows");
    const searchInput     = document.getElementById("search-text");
    const statusSelect    = document.getElementById("filter-status");
    const resultCountLabel= document.getElementById("result-count-label");

    let currentSearchText = "";
    let currentStatus     = "all";

    // ====== ユーティリティ ======
    function parseDate(str) {
      // "YYYY/MM/DD" を Date に変換
      const [y, m, d] = str.split("/").map(n => parseInt(n, 10));
      return new Date(y, m - 1, d);
    }

    function getFilteredItems() {
      const text = currentSearchText.trim().toLowerCase();
      return DOWNLOAD_ITEMS
        .filter(item => {
          if (currentStatus !== "all" && item.status !== currentStatus) return false;
          if (!text) return true;
          const haystack = (item.customerName + " " + item.recruitmentName).toLowerCase();
          return haystack.includes(text);
        })
        .sort((a, b) => {
          // 開講日昇順
          return parseDate(a.openingDate) - parseDate(b.openingDate);
        });
    }

    function renderList() {
      const items = getFilteredItems();
      rowsBody.innerHTML = "";

      resultCountLabel.textContent = `${items.length}件のデータ`;

      if (items.length === 0) {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="p-4 text-center text-xs text-gray-500" colspan="6">
            条件に一致するデータがありません。
          </td>
        `;
        rowsBody.appendChild(tr);
        return;
      }

      items.forEach(item => {
        const isAvailable = item.status === "DL可能";
        const badgeClass = isAvailable
          ? "bg-blue-50 text-blue-700 border border-blue-100"
          : "bg-gray-100 text-gray-500 border border-gray-200";
        const dotClass = isAvailable ? "bg-blue-500" : "bg-gray-400";

        const tr = document.createElement("tr");
        tr.className = "border-t hover:bg-gray-50/70";
        tr.innerHTML = `
          <td class="p-3 align-middle text-xs">
            <div class="flex flex-col">
              <span class="font-medium text-sm">${item.openingDate}</span>
            </div>
          </td>
          <td class="p-3 align-middle text-xs">
            ${item.deadlineDate}
          </td>
          <td class="p-3 align-middle">
            <span class="text-sm">${item.customerName}</span>
          </td>
          <td class="p-3 align-middle">
            <span class="text-sm">${item.recruitmentName}</span>
          </td>
          <td class="p-3 align-middle">
            <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs ${badgeClass}">
              <span class="w-2 h-2 rounded-full ${dotClass}"></span>
              ${item.status}
            </span>
          </td>
          <td class="p-3 align-middle text-center">
            <button
              class="inline-flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-semibold
                     ${isAvailable
                      ? "bg-blue-600 text-white hover:bg-blue-500"
                      : "bg-gray-200 text-gray-400 cursor-not-allowed"}"
              data-download-id="${item.id}"
              ${isAvailable ? "" : "disabled"}
            >
              <span class="material-symbols-outlined text-sm">
                ${isAvailable ? "download" : "block"}
              </span>
              ${isAvailable ? "ダウンロード" : "DL不可"}
            </button>
          </td>
        `;
        rowsBody.appendChild(tr);
      });

      // クリックイベント（モック）
      rowsBody.querySelectorAll("button[data-download-id]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-download-id");
          const target = DOWNLOAD_ITEMS.find(x => x.id === id);
          if (!target || target.status !== "DL可能") return;

          // 実装時はここでファイルDL API呼び出しなど
          alert(`モック：${target.customerName}「${target.recruitmentName}」（開講日: ${target.openingDate}）のデータをダウンロードします。`);
        });
      });
    }

    // ====== 初期化 ======
    document.addEventListener("DOMContentLoaded", () => {
      renderList();

      searchInput.addEventListener("input", () => {
        currentSearchText = searchInput.value;
        renderList();
      });

      statusSelect.addEventListener("change", () => {
        currentStatus = statusSelect.value;
        renderList();
      });
    });
  </script>