<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <title>New SD App</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nouislider@15.7.0/dist/nouislider.min.css">
        <script src="https://cdn.jsdelivr.net/npm/nouislider@15.7.0/dist/nouislider.min.js"></script>
        <script type="module" src="../js/modules/dashboard/index.js"></script>
        <script src="./js/role-visibility.js" defer></script>
        <script src="./js/mock-ui.js" defer></script>
        <style>
            body {
                font-family: "游ゴシック体", "Yu Gothic", "游ゴシック", YuGothic, sans-serif;
            }
        </style>
    </head>
    <body class="bg-gray-100 min-h-screen flex flex-col">
        <div id="app-header"></div>
        <main class="flex flex-1">
            <div id="app-sidebar"></div>
            <div class="p-10 flex-1 bg-gray-200">
                <div class="flex justify-between items-center mb-4">
                    <div class="text-2xl font-bold text-gray-700">オリジナルタグ一覧</div>
                </div>
                <div class="bg-white w-full  rounded-xl flex flex-col mx-auto shadow-md p-4">
                    <div class="p-4 flex flex-col md:flex-row items-center justify-between gap-4">
    <div class="flex items-center gap-2 w-full md:w-auto flex-1 max-w-2xl">
        <select class="bg-gray-50 border border-gray-300 text-gray-700 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 w-32 md:w-40">
            <option selected>すべてのタイプ</option>
            <option value="target">対象・階層</option>
            <option value="genre">ジャンル</option>
            </select>
        
        <div class="relative w-full">
            <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                <span class="material-symbols-outlined text-gray-400">search</span>
            </div>
            <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5" placeholder="タグ名で検索...">
        </div>
    </div>

    <button id="btnOpenModal" class="flex items-center justify-center gap-2 text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 transition shadow-sm whitespace-nowrap">
        <span class="material-symbols-outlined text-xl">add</span>
        <span>新規登録</span>
    </button>
</div>
                    <div class="p-4 w-full">
                        <table class="w-full max-w-4xl table-auto text-left text-gray-700">
                            <thead>
                                <tr>
                                    <th class="border-b px-4 py-3 text-sm text-gray-500">タグタイプ</th>
                                    <th class="border-b px-4 py-3 text-sm text-gray-500">タグ名</th>
                                    <th class="border-b px-4 py-3 text-sm text-gray-500">対象企業</th>
                                    <th class="border-b px-4 py-3 text-sm text-gray-500 text-center">ステータス</th>
                                    <th class="border-b px-4 py-3 text-sm text-gray-500 text-center">アクション</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="hover:bg-gray-50 transition-colors">
                                    <td class="border-b px-4 py-3">
                                        <span class="px-2 py-1 text-xs font-bold text-sky-600 bg-sky-100 rounded-md">対象・階層</span>
                                    </td>
                                    <td class="border-b px-4 py-3 font-medium">新人・内定者</td>
                                    <td class="border-b px-4 py-3 text-sm">
                                        <div class="flex flex-col">
                                            <span class="text-sm font-bold text-gray-700">○○株式会社</span>
                                            <span class="text-xs text-gray-400 font-mono">ID: 201129</span>
                                        </div>
                                    </td>
                                    <td class="border-b px-4 py-3 text-center">
                                        <span class="text-xs text-green-600 font-bold border border-green-200 bg-green-50 px-2 py-1 rounded-full">公開</span>
                                    </td>
                                    <td class="border-b px-4 py-3 text-center">
                                        <div class="relative group ml-1 inline-flex items-center">
                                            <span data-row="2" class="menu-trigger material-symbols-outlined text-gray-400 hover:text-gray-600 text-lg cursor-pointer align-middle">more_horiz</span>
                                            <div id="row-2-items" class="menu text-left flex flex-col absolute w-max z-10 bottom-full right-0 mb-1 bg-white border border-gray-200 rounded-lg shadow-xl p-1 hidden">
                                                <a href="#" class="py-2 px-3 text-sm text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded cursor-pointer flex items-center">
                                                    <span class="material-symbols-outlined text-lg mr-2">edit</span>
                                                    編集する
                                                </a>
                                                <a href="#" class="py-2 px-3 text-sm text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded cursor-pointer flex items-center">
                                                    <span class="material-symbols-outlined text-lg mr-2">public_off</span>
                                                    非公開にする
                                                </a>
                                                <hr class="my-1 border-gray-100">
                                                <a href="#" class="py-2 px-3 text-sm hover:bg-red-50 cursor-pointer flex items-center text-red-500 rounded">
                                                    <span class="material-symbols-outlined text-lg mr-2 text-red-500">delete</span>
                                                    削除する
                                                </a>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                
                                <tr class="hover:bg-gray-50 transition-colors">
                                    <td class="border-b px-4 py-3">
                                        <span class="px-2 py-1 text-xs font-bold text-rose-600 bg-rose-100 rounded-md">その他</span>
                                    </td>
                                    <td class="border-b px-4 py-3 font-medium">100％補助</td>
                                    <td class="border-b px-4 py-3 text-sm">
                                                                                <div class="flex flex-col">
                                            <span class="text-sm font-bold text-gray-700">○○株式会社</span>
                                            <span class="text-xs text-gray-400 font-mono">ID: 201129</span>
                                        </div>
                                    </td>
                                    <td class="border-b px-4 py-3 text-center">
                                        <span class="text-xs text-green-600 font-bold border border-green-200 bg-green-50 px-2 py-1 rounded-full">公開</span>
                                    </td>
                                    <td class="border-b px-4 py-3 text-center">
                                        <div class="relative group ml-1 inline-flex items-center">
                                            <span data-row="3" class="menu-trigger material-symbols-outlined text-gray-400 hover:text-gray-600 text-lg cursor-pointer align-middle">more_horiz</span>
                                            <div id="row-3-items" class="menu text-left flex flex-col absolute w-max z-10 bottom-full right-0 mb-1 bg-white border border-gray-200 rounded-lg shadow-xl p-1 hidden">
                                                <a href="#" class="py-2 px-3 text-sm text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded cursor-pointer flex items-center">
                                                    <span class="material-symbols-outlined text-lg mr-2">edit</span>
                                                    編集する
                                                </a>
                                            </div>
                                        </div>
                                    </td>
                                </tr>

                                <tr class="hover:bg-gray-50 transition-colors">
                                    <td class="border-b px-4 py-3">
                                        <span class="px-2 py-1 text-xs font-bold text-slate-600 bg-slate-100 rounded-md">ジャンル</span>
                                    </td>
                                    <td class="border-b px-4 py-3 font-medium">DX・ITスキル</td>
                                    <td class="border-b px-4 py-3 text-sm">
                                                                                <div class="flex flex-col">
                                            <span class="text-sm font-bold text-gray-700">○○株式会社</span>
                                            <span class="text-xs text-gray-400 font-mono">ID: 201129</span>
                                        </div>
                                    </td>
                                    <td class="border-b px-4 py-3 text-center">
                                        <span class="text-xs text-gray-500 font-bold border border-gray-200 bg-gray-50 px-2 py-1 rounded-full">非公開</span>
                                    </td>
                                    <td class="border-b px-4 py-3 text-center">
                                        <div class="relative group ml-1 inline-flex items-center">
                                            <span data-row="1" class="menu-trigger material-symbols-outlined text-gray-400 hover:text-gray-600 text-lg cursor-pointer align-middle">more_horiz</span>
                                            <div id="row-1-items" class="menu text-left flex flex-col absolute w-max z-10 bottom-full right-0 mb-1 bg-white border border-gray-200 rounded-lg shadow-xl p-1 hidden">
                                                <a href="#" class="py-2 px-3 text-sm text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded cursor-pointer flex items-center">
                                                    <span class="material-symbols-outlined text-lg mr-2">public</span>
                                                    公開する
                                                </a>
                                                <a href="#" class="py-2 px-3 text-sm hover:bg-red-50 cursor-pointer flex items-center text-red-500 rounded">
                                                    <span class="material-symbols-outlined text-lg mr-2 text-red-500">delete</span>
                                                    削除する
                                                </a>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>

        <div id="modal" class="fixed inset-0 z-50 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center hidden transition-opacity duration-300">
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg mx-4 overflow-hidden transform transition-all scale-100">
                <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                    <h2 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                        <span class="material-symbols-outlined text-blue-500">bookmark_add</span>
                        オリジナルタグ登録
                    </h2>
                    <button id="btnCloseModalHeader" class="text-gray-400 hover:text-gray-600 transition">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>

                <div class="p-6 flex flex-col gap-6">
                    <div class="flex flex-col gap-1.5" data-visible-for="iec">
                        <label class="text-sm font-bold text-gray-700">企業 <span class="text-red-500 text-xs ml-1">*</span></label>
                        <select class="w-full rounded-lg border border-gray-300 px-3 py-2.5 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white shadow-sm transition">
                            <option value="">企業を選択してください</option>
                            <option value="corp-1">IEC</option>
                            <option value="corp-2">産業能率大学</option>
                            <option value="corp-3">JTEX</option>
                            <option value="corp-4">○○食品株式会社</option>
                        </select>
                    </div>

                    <div class="flex flex-col gap-1.5">
                        <label class="text-sm font-bold text-gray-700">タグタイプ <span class="text-red-500 text-xs ml-1">*</span></label>
                        <select class="w-full rounded-lg border border-gray-300 px-3 py-2.5 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white shadow-sm transition">
                            <option value="">タイプを選択してください</option>
                            <option value="target">対象・階層（新人、管理職など）</option>
                            <option value="genre">ジャンル（営業、ITなど）</option>
                            <option value="level">難易度（初級、上級など）</option>
                            <option value="other">その他（補助金、キャンペーンなど）</option>
                        </select>
                        <p class="text-xs text-gray-400">※タグの性質に合わせて分類を選択してください。</p>
                    </div>

                    <div class="flex flex-col gap-1.5">
                        <label class="text-sm font-bold text-gray-700">タグ名 <span class="text-red-500 text-xs ml-1">*</span></label>
                        <input type="text" class="w-full rounded-lg border border-gray-300 px-3 py-2.5 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm transition" placeholder="例：2025年新人研修">
                    </div>

                    <div class="flex flex-col gap-1.5" data-visible-for="iec">
                    <label class="text-sm font-bold text-gray-700">ステータス</label>
                    <div class="flex w-full bg-gray-100 rounded-lg p-1">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="status" value="public" class="peer sr-only" checked>
                            <div class="text-center py-2 rounded-md text-sm font-medium text-gray-500 peer-checked:bg-white peer-checked:text-blue-600 peer-checked:shadow-sm transition-all flex items-center justify-center gap-1">
                                <span class="material-symbols-outlined text-lg">public</span>
                                公開
                            </div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="status" value="private" class="peer sr-only">
                            <div class="text-center py-2 rounded-md text-sm font-medium text-gray-500 peer-checked:bg-white peer-checked:text-gray-800 peer-checked:shadow-sm transition-all flex items-center justify-center gap-1">
                                <span class="material-symbols-outlined text-lg">lock</span>
                                非公開
                            </div>
                        </label>
                    </div>
                </div>
                </div>

                <div class="px-6 py-4 bg-gray-50 flex gap-3 justify-end border-t border-gray-100">
                    <button id="btnCloseModal" class="px-5 py-2 rounded-lg bg-white border border-gray-300 text-gray-600 font-medium hover:bg-gray-50 transition shadow-sm">キャンセル</button>
                    <button class="px-5 py-2 rounded-lg bg-blue-600 text-white font-bold hover:bg-blue-700 hover:shadow-md transition">登録する</button>
                </div>
            </div>
        </div>
    </body>
</html>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        // 初期ロールやブランド名・ユーザー名は自由に
        MockUI.injectHeader('#app-header', {
            userName: 'Test User',
            brand: 'New SD App',
            initialRole: 'iec', // 初回roleが未指定ならiecをセット
        });
        MockUI.injectSidebar('#app-sidebar');

        // サイドバー挿入直後に data-visible-for を反映
        // タイミング調整のため少し遅延させるか、MockUI側のコールバックを使うのが理想ですが、
        // ここでは簡易的にsetTimeoutを使用、またはRoleMockの仕様に合わせて調整してください。
        setTimeout(() => RoleMock.applyRoleVisibility(), 100);
    });

    const modal = document.getElementById('modal');
    const btnOpenModal = document.getElementById('btnOpenModal');
    const btnCloseModal = document.getElementById('btnCloseModal');
    const btnCloseModalHeader = document.getElementById('btnCloseModalHeader'); // 追加

    // モーダル開閉
    const toggleModal = (show) => {
        if (show) {
            modal.classList.remove('hidden');
        } else {
            modal.classList.add('hidden');
        }
    };

    btnOpenModal.addEventListener('click', () => toggleModal(true));
    btnCloseModal.addEventListener('click', () => toggleModal(false));
    if(btnCloseModalHeader) btnCloseModalHeader.addEventListener('click', () => toggleModal(false));

    // 背景クリックで閉じる
    modal.addEventListener('click', (e) => {
        if (e.target === modal) toggleModal(false);
    });


    // メニュー制御
    const triggers = document.querySelectorAll(".menu-trigger");
    const menus = document.querySelectorAll(".menu");

    triggers.forEach(trigger => {
        trigger.addEventListener("click", (e) => {
            e.stopPropagation();
            // 他のメニューを閉じる
            menus.forEach(menu => menu.classList.add("hidden"));
            // 対応するメニューを開閉
            const rowId = trigger.dataset.row;
            const menu = document.getElementById(`row-${rowId}-items`);
            if(menu) menu.classList.toggle("hidden");
        });
    });

    menus.forEach(menu => {
        menu.addEventListener("click", (e) => e.stopPropagation());
    });

    document.addEventListener("click", () => {
        menus.forEach(menu => menu.classList.add("hidden"));
    });
</script>